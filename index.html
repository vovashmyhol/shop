<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Turbo Gifts</title>

<!-- Telegram Web Apps SDK -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<!-- Lottie (JSON) -->
<script src="https://cdn.jsdelivr.net/npm/lottie-web@5.12.2/build/player/lottie.min.js"></script>
<!-- rlottie (на случай .tgs) -->
<script src="https://cdn.jsdelivr.net/npm/rlottie@2.6.0/dist/rlottie.min.js"></script>
<!-- GSAP для плавных анимаций (скрыть/показать) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

<style>
  :root{
    --bg:#0f1116;
    --bg-soft:#151822;
    --bg-card:#1a1e2a;
    --text:#e7ecf3;
    --muted:#9aa3b2;
    --banner-start:#43c2ff;
    --banner-end:#6aa8ff;
    --gold:#ffcd38;
    --radius:18px;
    --shadow: 0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--text);
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Inter, "SF Pro", Arial, sans-serif;
    line-height:1.35;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }
  /* контейнер приложения: центрируем и ограничиваем ширину (один файл для моб/ПК) */
  .app{
    max-width: 560px;
    margin: 0 auto;
    padding-bottom: 100px; /* место под нижнюю навигацию */
    min-height:100vh;
  }

  /* Верхняя панель */
  .topbar{
    position: sticky; top: 0; z-index: 30;
    background: linear-gradient(180deg, rgba(15,17,22,.98), rgba(15,17,22,.92) 70%, rgba(15,17,22,0));
    backdrop-filter: blur(8px);
    padding: 14px;
    border-bottom: 1px solid rgba(255,255,255,.04);
  }
  .profile{
    display:flex; align-items:center; gap:12px;
  }
  .avatar{
    width:40px;height:40px;border-radius:50%;
    background:#222; background-size:cover;background-position:center;
    border:2px solid #303544; flex-shrink:0;
  }
  .name{font-weight:700; font-size:18px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
  .top-right-space{flex:1}

  /* Баннер */
  .banner{
    margin:12px 14px 10px;
    background: linear-gradient(90deg, var(--banner-start), var(--banner-end));
    padding: 16px;
    border-radius: 20px;
    display:flex; align-items:center; justify-content:space-between;
    box-shadow: var(--shadow);
  }
  .banner .title{font-weight:800; font-size:18px}
  .banner .btn{
    background:white; color:#2b3a55; font-weight:700;
    padding:10px 16px; border-radius:16px; text-decoration:none;
    display:inline-flex; align-items:center; gap:8px;
    box-shadow: 0 6px 16px rgba(0,0,0,.12);
  }

  /* Toggle */
  .toggle{
    margin: 10px 14px 0; padding: 12px 14px;
    background: var(--bg-soft);
    border:1px solid #222838;
    border-radius: 18px;
    display:flex; align-items:center; gap:12px;
  }
  .toggle input{
    appearance:none; width:22px;height:22px;border-radius:6px;
    border:2px solid #556079; display:grid; place-items:center;
    background:#0f1116;
  }
  .toggle input:checked{
    background:#1f283b; border-color:#6aa8ff;
  }
  .toggle input:checked::after{
    content:"✓"; color:#a8c9ff; font-size:14px; line-height:1;
  }
  .toggle label{ color: var(--text); font-weight:600; cursor:pointer; user-select:none}

  /* Сетка карточек - оставляем 2 карточки ровно по центру */
  .grid{
    display:grid; gap:14px;
    grid-template-columns: 1fr 1fr;
    padding: 14px;
    justify-items:center;
    align-items:start;
  }
  @media (max-width:520px){
    .grid{ grid-template-columns: 1fr 1fr; gap:12px; padding:12px }
  }
  @media (max-width:380px){
    /* на очень маленьких экранах сделали по одной колонке */
    .grid{ grid-template-columns: 1fr; }
  }

  .card{
    position:relative; overflow:hidden; border-radius:20px;
    background: radial-gradient(120% 120% at 0% 0%, #20263a 0%, #1a1f2d 40%, #161b28 100%);
    border:1px solid #262c41;
    height: 220px;
    width: 100%;
    max-width: 240px;
    box-shadow: var(--shadow);
    display:flex; flex-direction:column; justify-content:flex-end;
    transform-origin:center center;
  }
  .card .media{
    position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
    padding: 20px;
  }
  .media canvas, .media svg, .media img, .media div{max-width:100%;max-height:100%}
  .card .price{
    position:relative; margin:0 14px 14px;
    background:rgba(19,22,31,.75);
    border:1px solid rgba(255,255,255,.06);
    padding: 10px 14px; border-radius:16px; display:inline-flex; align-items:center; gap:8px;
    backdrop-filter: blur(4px);
  }
  .star{
    width:18px;height:18px; display:inline-block;
    mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23000" d="m12 2 2.9 6 6.6.6-5 4.3 1.4 6.5L12 16.8 6.1 19.4 7.5 13 2.5 8.6l6.6-.6L12 2z"/></svg>') center/contain no-repeat;
    background-color: var(--gold);
  }

  /* Ленточка продано / 1 из 1000 */
  .ribbon{
    position:absolute; top:10px; right:-42px; transform: rotate(35deg);
    color:white; font-weight:800; font-size:13px; letter-spacing:.3px;
    padding: 8px 46px; box-shadow:0 8px 16px rgba(0,0,0,.25);
    border-top-left-radius:6px; border-top-right-radius:6px;
    pointer-events:none;
  }
  .ribbon.sold {
    background: linear-gradient(180deg, #ff8a95, #e64655);
  }
  .ribbon.stock {
    background: linear-gradient(90deg,#66c2ff,#3aa6ff); /* голубая ленточка */
  }

  /* Bottom nav */
  .tabbar{
    position: fixed; left:0; right:0; bottom:0; z-index:50;
    display:flex; justify-content:center;
    padding: 12px 10px;
    background: linear-gradient(0deg, rgba(15,17,22,1), rgba(15,17,22,.95));
    border-top:1px solid rgba(255,255,255,.03);
  }
  .tabs{
    width:min(560px, 100%); display:flex; gap:18px; justify-content:center;
  }
  .tab{
    width:62px;height:62px;border-radius:14px;
    background:#111523; border:1px solid #252b3d;
    display:grid; place-items:center;
    box-shadow: 0 8px 18px rgba(0,0,0,.25);
    cursor:pointer; user-select:none;
    transition: transform .08s ease, box-shadow .12s ease;
    overflow:hidden;
  }
  .tab:active{ transform: translateY(1px) }
  .tab.active{ outline:2px solid #3f69ff55; background:#151b2b }
  /* внутри табов — img чтобы вы могли просто подставить свои png (заменить src) */
  .tab img{ width:34px; height:34px; object-fit:contain; display:block; pointer-events:none }
  .tab .placeholder{
    color:var(--muted); font-size:12px;
  }

  /* плавное появление/исчезание запасных карточек (фоллбек) */
  .hidden-fallback{ opacity:0; transform: scale(.98); pointer-events:none }

  /* подсказка для Lottie */
  .lottie-placeholder{ color:var(--muted); font-size:12px; text-align:center; padding:8px }
</style>
</head>
<body>
  <div class="app">
    <!-- Верхняя панель -->
    <div class="topbar">
      <div class="profile">
        <div id="avatar" class="avatar" aria-hidden="true"></div>
        <div class="name" id="userName">Volodymyr</div>
        <div class="top-right-space"></div>
      </div>
    </div>

    <!-- Баннер -->
    <div class="banner">
      <div class="title">Turbo Gifts here!</div>
      <a href="#" class="btn">Open Gifts</a>
    </div>

    <!-- Переключатель "Скрыть проданные" -->
    <div class="toggle">
      <input id="hideSold" type="checkbox" />
      <label for="hideSold">Скрыть проданные подарки</label>
    </div>

    <!-- Сетка карточек (только 2 карточки, как просили) -->
    <div class="grid" id="cardsGrid">
      <!-- Карточка 1 — В НАЛИЧИИ (ленточка голубая "1 из 1000") -->
      <article class="card" data-sold="false" id="card1">
        <div class="ribbon stock">1 из 1000</div>
        <div class="media lottie" data-lottie-url="https://raw.githubusercontent.com/vovashmyhol/shop/refs/heads/main/002_DOG%20(1).json">
          <!-- TODO: вставьте raw-ссылку на Lottie JSON/.tgs -->
          <div class="lottie-placeholder">Lottie animation 1 — вставьте ссылку в data-lottie-url</div>
        </div>
        <div class="price"><span class="star"></span> <strong>15</strong></div>
      </article>

      <!-- Карточка 2 — ПРОДАНА -->
      <article class="card" data-sold="true" id="card2">
        <div class="ribbon sold">Продано</div>
        <div class="media lottie" data-lottie-url="https://raw.githubusercontent.com/vovashmyhol/shop/refs/heads/main/002_DOG%20(1).json">
          <!-- TODO: вставьте raw-ссылку на Lottie JSON/.tgs -->
          <div class="lottie-placeholder">Lottie animation 2 — вставьте ссылку в data-lottie-url</div>
        </div>
        <div class="price"><span class="star"></span> <strong>15</strong></div>
      </article>
    </div>
  </div>

  <!-- Нижняя навигация (теперь 3 вкладки; заменяйте src у img на свои png) -->
  <nav class="tabbar" aria-hidden="false">
    <div class="tabs" role="tablist" aria-label="Navigation">
      <div class="tab active" role="tab" aria-selected="true" title="Tab 1" id="tab1">
        <!-- Подставьте своё PNG: замените src -->
        <img src="https://dummyimage.com/64x64/2b3345/ffffff&text=1" alt="tab1 icon" data-placeholder="true">
      </div>

      <div class="tab" role="tab" aria-selected="false" title="Tab 2" id="tab2">
        <img src="https://dummyimage.com/64x64/2b3345/ffffff&text=2" alt="tab2 icon" data-placeholder="true">
      </div>

      <div class="tab" role="tab" aria-selected="false" title="Tab 3" id="tab3">
        <img src="https://dummyimage.com/64x64/2b3345/ffffff&text=3" alt="tab3 icon" data-placeholder="true">
      </div>
    </div>
  </nav>

<script>
/*
  Инструкции по использованию (коротко):
  - Подставьте ссылки Lottie: замените data-lottie-url у .media.lottie на ваши raw .json или .tgs ссылки.
  - Чтобы заменить иконки внизу: замените src у <img> внутри .tab.
  - Аватар и имя сверху автоматически подтянутся из Telegram Web App (если страница открыта как Web App).
*/

/* ---------- Подключение имени и аватара из Telegram Web App ---------- */
(function initTelegramUser(){
  try {
    if(window.Telegram && Telegram.WebApp){
      Telegram.WebApp.ready();
      const initDataUnsafe = Telegram.WebApp.initDataUnsafe || {};
      const user = initDataUnsafe.user || null;

      const nameEl = document.getElementById('userName');
      const avatarEl = document.getElementById('avatar');

      if(user){
        // составим отображаемое имя
        const parts = [];
        if(user.first_name) parts.push(user.first_name);
        if(user.last_name) parts.push(user.last_name);
        if(parts.length === 0 && user.username) parts.push(user.username);
        if(parts.length === 0) parts.push('User');

        nameEl.textContent = parts.join(' ');

        // Если Telegram отдаёт photo_url (не всегда бывает), используем
        if(user.photo_url){
          avatarEl.style.backgroundImage = `url("${user.photo_url}")`;
        } else {
          // Генерируем SVG с инициалами как data-url
          const initials = (parts[0] || 'U').split(' ').map(s=>s[0]).join('').slice(0,2).toUpperCase();
          const bg = '#2b3345';
          const fg = '#ffffff';
          const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200'><rect width='100%' height='100%' fill='${bg}' rx='40'/><text x='50%' y='50%' font-family='Arial, sans-serif' font-size='90' fill='${fg}' dominant-baseline='middle' text-anchor='middle'>${initials}</text></svg>`;
          const url = 'data:image/svg+xml;charset=utf8,' + encodeURIComponent(svg);
          avatarEl.style.backgroundImage = `url("${url}")`;
        }
      }
    }
  } catch (e){
    console.warn('Telegram init error', e);
  }
})();


/* ---------- Подгрузка Lottie-анимаций (.json через lottie-web, .tgs через rlottie) ---------- */
function loadLottieFor(el){
  const url = el.getAttribute('data-lottie-url');
  if(!url) return;

  // Очистим плейсхолдер
  el.innerHTML = '';

  // Если JSON -> lottie-web
  if(/\.json(\?|$)/i.test(url) && window.lottie){
    try {
      lottie.loadAnimation({
        container: el,
        renderer: 'svg',
        loop: true,
        autoplay: true,
        path: url
      });
      return;
    } catch(err){
      el.innerHTML = `<div class="lottie-placeholder">Ошибка загрузки Lottie JSON</div>`;
    }
  }

  // Если .tgs -> rlottie
  if(/\.tgs(\?|$)/i.test(url) && window.rlottie){
    try {
      const player = new rlottie.Player({
        name: 'anim-'+Math.random().toString(36).slice(2),
        src: url,
        loop: true,
        autoplay: true,
        container: el
      });
      el.style.display = 'grid';
      el.style.placeItems = 'center';
      return;
    } catch(err){
      el.innerHTML = `<div class="lottie-placeholder">Ошибка загрузки TGS</div>`;
    }
  }

  // fallback — пробуем загрузить как картинку (если это URL к svg/png), иначе подсказка
  if(/\.(svg|png|jpg|jpeg|gif)(\?|$)/i.test(url)){
    const img = document.createElement('img');
    img.src = url;
    img.alt = 'media';
    el.appendChild(img);
    return;
  }

  el.innerHTML = '<div class="lottie-placeholder">Укажите raw ссылку на Lottie (.json или .tgs)</div>';
}

document.querySelectorAll('.media.lottie').forEach(loadLottieFor);


/* ---------- Плавное скрытие/показ "проданных" карточек через GSAP ---------- */
/* Логика: карточки, у которых data-sold="true" считаются распроданными. При чекнутом чекбоксе —
   мы плавно уменьшаем их (scale -> 0.96, opacity -> 0), затем display:none.
   При отмене чекбокса — делаем display:block и плавно возвращаем.
*/
const hideSoldCheckbox = document.getElementById('hideSold');
const soldSelector = '[data-sold="true"]';
const soldCards = () => Array.from(document.querySelectorAll(soldSelector));

// инициализируем видимость по умолчанию (если чекбокс ранее запомнен браузером)
(function initSoldState(){
  // сбрасываем сразу стиль (чтобы анимация корректно работала)
  soldCards().forEach(card=>{
    card.style.willChange = 'opacity, transform';
  });
})();
function hideSoldAnimated(){
  const cards = soldCards();
  if(cards.length === 0) return;
  // анимируем: opacity 0, scale 0.95 и потом display:none
  cards.forEach((c, idx)=>{
    // если уже скрыт - пропускаем
    if(c.dataset._hidden === '1') return;
    gsap.to(c, {
      duration: 0.35,
      ease: 'power2.out',
      opacity: 0,
      scale: 0.96,
      y: -6,
      onComplete: () => {
        c.style.display = 'none';
        c.dataset._hidden = '1';
      }
    });
  });
}

function showSoldAnimated(){
  const cards = document.querySelectorAll(soldSelector);
  if(cards.length === 0) return;
  cards.forEach((c)=>{
    if(c.dataset._hidden !== '1') return;
    // сетим обратно display и делаем анимацию появления
    c.style.display = ''; // вернёт стиль по умолчанию
    // сразу делаем невидимым в начале для анимации
    gsap.set(c, {opacity:0, scale:0.96, y:-6});
    gsap.to(c, {duration:0.4, ease:'power2.out', opacity:1, scale:1, y:0, onComplete: ()=>{ c.dataset._hidden = '0'; }});
  });
}

hideSoldCheckbox.addEventListener('change', ()=>{
  if(typeof gsap === 'undefined'){
    // фоллбек без gsap — просто toggle display
    const cards = soldCards();
    cards.forEach(c => {
      if(hideSoldCheckbox.checked) c.style.display = 'none';
      else c.style.display = '';
    });
    return;
  }
  if(hideSoldCheckbox.checked) hideSoldAnimated();
  else showSoldAnimated();
});

// сброс атрибутов _hidden при загрузке, если чекбокс не отмечен
window.addEventListener('load', ()=>{
  if(!hideSoldCheckbox.checked){
    soldCards().forEach(c => { c.dataset._hidden = '0'; c.style.display = ''; c.style.opacity = 1; c.style.transform = 'none'; });
  } else {
    // если изначально отмечен — скрываем плавно после маленькой задержки
    setTimeout(()=>hideSoldAnimated(), 120);
  }
});


/* ---------- Таббар: возможность подставлять свои PNG (у вас есть <img> в каждом .tab) ---------- */
document.querySelectorAll('.tabs .tab').forEach(tab=>{
  tab.addEventListener('click', ()=>{
    document.querySelectorAll('.tabs .tab').forEach(t=>{
      t.classList.remove('active');
      t.setAttribute('aria-selected','false');
    });
    tab.classList.add('active');
    tab.setAttribute('aria-selected','true');
    // можно добавить свой обработчик клика тут (navigate, open modal и т.п.)
  });
});

/* ---------- Подстройка для плавности при ресайзе (необязательно) ---------- */
let resizeTimer = null;
window.addEventListener('resize', () => {
  if (resizeTimer) clearTimeout(resizeTimer);
  resizeTimer = setTimeout(()=> {
    // при необходимости можно пересчитать что-то
  }, 120);
});

/* ---------- Подсказки: где менять контент ---------- */
/*
  1) Lottie-анимации:
     - Откройте элементы .media.lottie и замените значение data-lottie-url на вашу raw ссылку (.json или .tgs).
       Например:
         <div class="media lottie" data-lottie-url="https://assets7.lottiefiles.com/packages/lf20_xxx.json"></div>

  2) Иконки внизу:
     - Замените src у <img> внутри .tab на путь к вашему PNG (или SVG).
     - Пример: <img src="/my/icons/home.png" alt="home">

  3) Аватар и имя:
     - Если открыто в Telegram Web App — имя и аватар берутся автоматически.
     - Если страница открыта в браузере напрямую — отображается SVG с инициалами или имя "Volodymyr".

  4) Первый товар: сейчас помечен data-sold="false" (в наличии) и лента "1 из 1000" голубая.
     Второй — data-sold="true" (распродан) с лентой "Продано".
*/

/* ---------- Уменьшенный фоллбек стилей, если GSAP не загрузился ---------- */
if(typeof gsap === 'undefined'){
  console.warn('GSAP не загружен — анимации скрыть/показ будут упрощёнными.');
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Turbo Gifts</title>

<!-- Telegram Web Apps SDK -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<!-- lottie-web для .json -->
<script src="https://cdn.jsdelivr.net/npm/lottie-web@5.12.2/build/player/lottie.min.js"></script>
<!-- rlottie (для .tgs) -->
<script src="https://cdn.jsdelivr.net/npm/rlottie@2.6.0/dist/rlottie.min.js"></script>
<!-- GSAP для плавной анимации скрытия/появления -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

<style>
  :root{
    --bg:#0f1116;
    --bg-soft:#151822;
    --card-bg:#1a1e2a;
    --text:#e7ecf3;
    --muted:#9aa3b2;
    --accent-blue-start:#43c2ff;
    --accent-blue-end:#6aa8ff;
    --gold:#ffcd38;
    --radius:18px;
    --card-footer-h:56px; /* высота блока с ценой */
    --tab-size:46px; /* размер нижней вкладки */
    --shadow: 0 10px 30px rgba(0,0,0,.35);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Inter, "SF Pro", Arial, sans-serif;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    line-height:1.35;
  }

  /* --- App container --- */
  .app{
    max-width: 560px;
    margin: 0 auto;
    min-height: 100vh;
    padding-bottom: calc(var(--tab-size) + 28px); /* место под таббар */
  }

  /* --- Topbar --- */
  .topbar{
    position: sticky;
    top:0;
    z-index:40;
    padding: 5px 10px;
    background: linear-gradient(180deg, rgba(15,17,22,.98), rgba(15,17,22,.92) 70%, rgba(15,17,22,0));
    border-bottom: 1px solid rgba(255,255,255,.04);
    backdrop-filter: blur(6px);
  }
  .profile{ display:flex; align-items:center; gap:4px; }
  .avatar{
    width:36px; height:36px; border-radius:50%;
    background:#222; background-position:center; background-size:cover;
    border:2px solid #303544; flex-shrink:0;
    margin: 5px
  }
  .name{ font-weight:600; font-size:17px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

  /* --- Banner (уменьшенный) --- */
  .banner{
    margin:12px 14px;
    padding: 13px 12px; /* уменьшили высоту */
    border-radius: 14px;
    background: linear-gradient(90deg, var(--accent-blue-start), var(--accent-blue-end));
    display:flex; align-items:center; justify-content:space-between;
    box-shadow: var(--shadow);
  }
  .banner .title{ font-weight:700; font-size:16px; margin:0px 5px }
  .banner .btn{
    background: #fff;
    color: #09b5ff;
    font-weight:700;
    padding:6px 10px; /* компактнее */
    border-radius:12px;
    text-decoration:none;
    font-size:13px;
    display:inline-flex; align-items:center; gap:8px;
  }

  /* --- Toggle --- */
  .toggle{
    margin: 10px 14px 0;
    padding: 12px 14px;
    background: var(--bg-soft);
    border:1px solid #222838;
    border-radius: 16px;
    display:flex; align-items:center; gap:12px;
  }
  .toggle input{
    appearance:none; width:22px;height:22px;border-radius:6px;
    border:2px solid #556079; display:grid; place-items:center;
    background:#0f1116;
  }
  .toggle input:checked{ background:#1f283b; border-color:#6aa8ff; }
  .toggle input:checked::after{ content:"✓"; color:#a8c9ff; font-size:14px; line-height:1; }
  .toggle label{ color: var(--text); font-weight:600; cursor:pointer; user-select:none; }

  /* --- Grid: всегда 2 карточки в ряд --- */
  .grid{
    display:grid;
    grid-template-columns: repeat(2, 1fr);
    gap:14px;
    padding: 14px;
    justify-items:center;
    align-items:start;
  }
  /* не делаем single-column: ты просил всегда 2 */

  /* --- Card --- */
  .card{
    position:relative;
    overflow:hidden;
    border-radius:16px;
    background: radial-gradient(120% 120% at 0% 0%, #20263a 0%, #1a1f2d 40%, #161b28 100%);
    border:1px solid #262c41;
    width:100%;
    max-width: 260px;
    height: 280px; /* немного выше, чтобы footer/cena помещались */
    display:flex;
    flex-direction:column;
    justify-content:flex-end;
    box-shadow: var(--shadow);
  }

  /* Media area (анимация) — даём отступ внизу равный высоте footer,
     чтобы анимация не заходила под цену */
  .card .media{
    position: absolute;
    left:0; right:0; top:0;
    height: calc(100% - var(--card-footer-h));
    display:flex; align-items:center; justify-content:center;
    padding: 16px;
  }
  .media canvas, .media svg, .media img, .media div{ max-width:100%; max-height:100%; }

  /* Footer / price — внизу карточки, отдельная панель, не перекрывает медиа */
  .card .footer{
    height: var(--card-footer-h);
    display:flex; align-items:center; justify-content:center;
    position:relative;
    padding: 10px 14px;
    background: linear-gradient(180deg, rgba(11,13,18,.35), rgba(11,13,18,.55));
    border-top: 1px solid rgba(255,255,255,.03);
    backdrop-filter: blur(4px);
  }
  .price {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 15px;
  font-weight: 700;
  margin-bottom: 8px;
  color: #FFD700;
}

.price-icon {
  width: 16px;      /* размер иконки как символ */
  height: 16px;
  margin-right: 4px;
  object-fit: contain;
}


  /* Ribbon */
  .ribbon{
    position:absolute;
    top:12px;
    right:-42px;
    transform: rotate(35deg);
    color:white; font-weight:800; font-size:13px; letter-spacing:.3px;
    padding: 8px 46px; box-shadow:0 8px 16px rgba(0,0,0,.25);
    border-top-left-radius:6px; border-top-right-radius:6px;
    pointer-events:none;
  }
  .ribbon.sold { background: linear-gradient(180deg, #ff8a95, #e64655); }
  .ribbon.stock { background: linear-gradient(90deg,#66c2ff,#3aa6ff); }

  /* --- Tabbar (уменьшенный) --- */
  .tabbar{
    position: fixed; left:0; right:0; bottom:0; z-index:60;
    display:flex; justify-content:center; align-items:center;
    padding:8px 10px; background: linear-gradient(0deg, rgba(15,17,22,1), rgba(15,17,22,.96));
    border-top:1px solid rgba(255,255,255,.03);
  }
  .tabs{
    width:min(560px, 100%); display:flex; gap:12px; justify-content:center;
  }
  .tab{
    width: var(--tab-size); height: var(--tab-size);
    border-radius:12px; background:#111523; border:1px solid #252b3d;
    display:grid; place-items:center; cursor:pointer;
    box-shadow: 0 8px 18px rgba(0,0,0,.25);
    transition: transform .08s;
    overflow:hidden;
  }
  .tab img{ width:20px; height:20px; object-fit:contain; pointer-events:none; display:block }
  .tab.active{ outline:2px solid #3f69ff55; transform: translateY(-2px); }

  /* Helpers */
  .hidden-fallback{ opacity:0; transform: scale(.98); pointer-events:none }
  .lottie-placeholder{ color:var(--muted); font-size:12px; text-align:center; padding:8px }
  .visually-hidden{ position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden; }
</style>
</head>
<body>
  <div class="app">
    <!-- Topbar -->
    <div class="topbar">
      <div class="profile">
        <div id="avatar" class="avatar" aria-hidden="true"></div>
        <div id="userName" class="name">Volodymyr</div>
      </div>
    </div>

    <!-- Banner (уменьшенный) -->
    <div class="banner" role="region" aria-label="banner">
      <div class="title">Turbo Gifts here!</div>
      <!-- Замените href на вашу ссылку -->
      <a id="bannerBtn" class="btn" href="https://example.com" target="_blank" rel="noopener noreferrer">Open Gifts</a>
    </div>

    <!-- Toggle -->
    <div class="toggle" role="group" aria-label="Фильтр">
      <input id="hideSold" type="checkbox" />
      <label for="hideSold">Скрыть проданные подарки</label>
    </div>

    <!-- Grid: ровно 2 подарка -->
    <div class="grid" id="cardsGrid" aria-live="polite">
      <!-- Карточка 1: В НАЛИЧИИ (голубая ленточка "1 из 1000") -->
      <article class="card" id="card1" data-sold="false" role="article" aria-label="Подарок 1">
        <div class="ribbon stock" aria-hidden="true">1 из 1000</div>
        <div class="media lottie" data-lottie-url="https://raw.githubusercontent.com/vovashmyhol/shop/refs/heads/main/002_DOG%20(1).json">
          <div class="lottie-placeholder">Lottie animation 1 — вставьте ссылку в data-lottie-url</div>
        </div>
        <div class="footer">
          <div class="price">
  <img src="stars-DBKMczxe.png" alt="icon" class="price-icon">
  <span class="price-value">15</span>
</div>

        </div>
      </article>

      <!-- Карточка 2: Продана -->
      <article class="card" id="card2" data-sold="true" role="article" aria-label="Подарок 2 (продан)">
        <div class="ribbon sold" aria-hidden="true">Продано</div>
        <div class="media lottie" data-lottie-url="https://raw.githubusercontent.com/vovashmyhol/shop/refs/heads/main/002_DOG%20(1).json">
          <div class="lottie-placeholder">Lottie animation 2 — вставьте ссылку в data-lottie-url</div>
        </div>
        <div class="footer">
          <div class="price">
  <img src="stars-DBKMczxe.png" alt="icon" class="price-icon">
  <span class="price-value">15</span>
</div>
      </article>
    </div>
  </div>

  <!-- Tabbar — заменяйте src у img на свои PNG -->
  <nav class="tabbar" role="navigation" aria-label="Основная навигация">
    <div class="tabs" role="tablist">
      <div class="tab active" role="tab" aria-selected="true" id="tab1" title="Tab 1">
        <img src="https://dummyimage.com/64x64/2b3345/ffffff&text=1" alt="tab1 icon">
      </div>
      <div class="tab" role="tab" aria-selected="false" id="tab2" title="Tab 2">
        <img src="https://dummyimage.com/64x64/2b3345/ffffff&text=2" alt="tab2 icon">
      </div>
      <div class="tab" role="tab" aria-selected="false" id="tab3" title="Tab 3">
        <img src="https://dummyimage.com/64x64/2b3345/ffffff&text=3" alt="tab3 icon">
      </div>
    </div>
  </nav>

<script>
/* ===========================================================
   Полный код: Telegram WebApp init, Lottie/rlottie загрузчики,
   плавное скрытие/показ распроданных через GSAP, таббар,
   resize handler и подсказки — всё сохранил и доработал.
   =========================================================== */

/* ---------- Telegram Web App: имя и аватар ---------- */
(function initTelegramUser(){
  try {
    if(window.Telegram && Telegram.WebApp){
      Telegram.WebApp.ready();
      const initDataUnsafe = Telegram.WebApp.initDataUnsafe || {};
      const user = initDataUnsafe.user || null;
      const nameEl = document.getElementById('userName');
      const avatarEl = document.getElementById('avatar');

      if(user){
        const parts = [];
        if(user.first_name) parts.push(user.first_name);
        if(user.last_name) parts.push(user.last_name);
        if(parts.length === 0 && user.username) parts.push(user.username);
        if(parts.length === 0) parts.push('User');

        nameEl.textContent = parts.join(' ');

        if(user.photo_url){
          avatarEl.style.backgroundImage = `url("${user.photo_url}")`;
        } else {
          const initials = parts.map(p=>p[0]||'').join('').slice(0,2).toUpperCase() || 'U';
          const bg = '#2b3345';
          const fg = '#fff';
          const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200'><rect width='100%' height='100%' fill='${bg}' rx='40'/><text x='50%' y='50%' font-family='Arial,sans-serif' font-size='90' fill='${fg}' dominant-baseline='middle' text-anchor='middle'>${initials}</text></svg>`;
          avatarEl.style.backgroundImage = `url("data:image/svg+xml;charset=utf8,${encodeURIComponent(svg)}")`;
        }
      }
    }
  } catch(err){
    console.warn('Telegram init error', err);
  }
})();

/* ---------- Lottie / rlottie загрузка ---------- */
function loadLottieFor(el){
  const url = el.getAttribute('data-lottie-url');
  if(!url){
    // ничего не задано — оставляем плейсхолдер
    return;
  }
  // очистим содержимое контейнера
  el.innerHTML = '';

  // Если JSON (lottie-web)
  if(/\.json(\?|$)/i.test(url) && window.lottie){
    try {
      lottie.loadAnimation({
        container: el,
        renderer: 'svg',
        loop: true,
        autoplay: true,
        path: url
      });
      return;
    } catch(e){
      el.innerHTML = '<div class="lottie-placeholder">Ошибка загрузки Lottie JSON</div>';
    }
  }

  // Если .tgs (rlottie)
  if(/\.tgs(\?|$)/i.test(url) && window.rlottie){
    try {
      const player = new rlottie.Player({
        name: 'anim-' + Math.random().toString(36).slice(2),
        src: url,
        loop: true,
        autoplay: true,
        container: el
      });
      el.style.display = 'grid'; el.style.placeItems = 'center';
      return;
    } catch(e){
      el.innerHTML = '<div class="lottie-placeholder">Ошибка загрузки TGS</div>';
    }
  }

  // fallback: если это картинка
  if(/\.(svg|png|jpg|jpeg|gif)(\?|$)/i.test(url)){
    const img = document.createElement('img');
    img.src = url;
    img.alt = 'media';
    img.style.maxWidth = '100%';
    img.style.maxHeight = '100%';
    el.appendChild(img);
    return;
  }

  el.innerHTML = '<div class="lottie-placeholder">Укажите raw ссылку на Lottie (.json или .tgs)</div>';
}

document.querySelectorAll('.media.lottie').forEach(loadLottieFor);

/* ---------- Плавное скрытие/показ "проданных" карточек с GSAP ---------- */
const hideSoldCheckbox = document.getElementById('hideSold');
const soldSelector = '[data-sold="true"]';
const soldCards = () => Array.from(document.querySelectorAll(soldSelector));

// подготовка карточек (willChange)
soldCards().forEach(c => { c.style.willChange = 'opacity, transform'; c.dataset._hidden = '0'; });

// скрыть с анимацией
function hideSoldAnimated(){
  const cards = soldCards();
  cards.forEach(c => {
    if(c.dataset._hidden === '1') return;
    gsap.to(c, {
      duration: 0.36,
      ease: 'power2.out',
      opacity: 0,
      scale: 0.98,
      y: -8,
      onComplete: () => {
        c.style.display = 'none';
        c.dataset._hidden = '1';
      }
    });
  });
}

// показать с анимацией
function showSoldAnimated(){
  const cards = document.querySelectorAll(soldSelector);
  cards.forEach(c => {
    if(c.dataset._hidden !== '1') return;
    c.style.display = ''; // возвращаем рендер
    gsap.set(c, {opacity:0, scale:0.98, y:-8});
    gsap.to(c, {
      duration: 0.4,
      ease: 'power2.out',
      opacity: 1,
      scale: 1,
      y: 0,
      onComplete: ()=> { c.dataset._hidden = '0'; }
    });
  });
}

hideSoldCheckbox.addEventListener('change', ()=>{
  if(typeof gsap === 'undefined'){
    // фоллбек если GSAP не доступен
    const cards = soldCards();
    cards.forEach(c => { c.style.display = hideSoldCheckbox.checked ? 'none' : ''; });
    return;
  }
  if(hideSoldCheckbox.checked) hideSoldAnimated();
  else showSoldAnimated();
});

// init state on load
window.addEventListener('load', ()=>{
  if(hideSoldCheckbox.checked) {
    // если отмечен, скрываем
    setTimeout(hideSoldAnimated, 120);
  } else {
    // показываем все
    document.querySelectorAll(soldSelector).forEach(c => {
      c.dataset._hidden = '0'; c.style.display = ''; c.style.opacity = 1; c.style.transform = 'none';
    });
  }
});

/* ---------- Таббар клики (простая логика выделения) ---------- */
document.querySelectorAll('.tabs .tab').forEach(tab=>{
  tab.addEventListener('click', ()=>{
    document.querySelectorAll('.tabs .tab').forEach(t=>{
      t.classList.remove('active');
      t.setAttribute('aria-selected','false');
    });
    tab.classList.add('active');
    tab.setAttribute('aria-selected','true');
    // сюда можно добавить переходы/открытие модального окна и т.д.
  });
});

/* ---------- Resize handler (как просил) ---------- */
let resizeTimer = null;
window.addEventListener('resize', () => {
  if (resizeTimer) clearTimeout(resizeTimer);
  resizeTimer = setTimeout(()=> {
    // при желании можно пересчитать размеры, сейчас оставлено пустым
  }, 120);
});

/* ---------- Полезные подсказки (комментарии) ----------
  - Замена Lottie:
      <div class="media lottie" data-lottie-url="https://assetsX.lottiefiles.com/packages/lf20_xxx.json"></div>

  - Заменить иконки вкладок:
      <img src="/path/to/your/icon1.png">

  - Ссылка кнопки баннера:
      document.getElementById('bannerBtn').href = 'https://your-link.example';

  - Первый товар: data-sold="false" (в наличии) и синяя ленточка "1 из 1000".
    Второй товар: data-sold="true" (распродан) и ленточка "Продано".

  - Если GSAP не загружается — анимации скрытия/показа будут упрощёнными.
--------------------------------------------------------------- */

if(typeof gsap === 'undefined'){
  console.warn('GSAP не загружен — плавные анимации скрыть/показ упрощены.');
}
</script>
</body>
</html>
